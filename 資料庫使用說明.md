# TQM 系統雙資料庫架構使用說明

## 📚 系統架構

系統現在支援兩種資料庫模式：

### 1️⃣ Firebase 模式（雲端）
- ✅ 原有的 Firebase Firestore 雲端資料庫
- ✅ 支援多人協作、即時同步
- ✅ 需要網路連線
- ✅ 保留所有備份功能

### 2️⃣ Local 模式（本地）
- ✅ 使用 IndexedDB 本地資料庫
- ✅ 離線可用，不需網路
- ✅ 資料存在瀏覽器中
- ✅ 適合本地測試和開發

---

## 🚀 快速開始

### 第一步：開啟系統設定頁面
1. 登入 TQM 系統
2. 點擊左側選單「系統設定」
3. 查看「資料庫模式設定」區塊

### 第二步：從 Firebase 匯出備份
1. 點擊「匯出 Firebase 資料」按鈕
2. 下載備份 JSON 檔案（例如：`TQM_Firebase_備份_2026-1-13.json`）
3. 將檔案保存到安全位置

### 第三步：匯入到本地資料庫
1. 點擊「匯入到本地資料庫」按鈕
2. 系統會自動從 Firebase 讀取最新資料並匯入
3. 等待匯入完成（顯示成功訊息）

### 第四步：切換到本地模式測試
1. 點擊「本地模式」按鈕
2. 確認切換（頁面會重新載入）
3. 系統現在使用本地 IndexedDB

---

## 🔄 資料同步流程

### 情境A：從 Firebase 切換到本地測試
```
Firebase (雲端) 
    ↓ 匯出備份
JSON 檔案
    ↓ 匯入到本地
IndexedDB (本地)
    ↓ 切換模式
本地測試環境
```

### 情境B：測試完成後回到 Firebase
```
本地測試
    ↓ 切換模式
Firebase 模式
    ↓ 繼續使用雲端資料
正式環境
```

---

## 📋 功能對照表

| 功能 | Firebase 模式 | Local 模式 |
|------|--------------|------------|
| 新增資料 | ✅ | ✅ |
| 修改資料 | ✅ | ✅ |
| 刪除資料 | ✅ | ✅ |
| 即時訂閱 | ✅ | ✅ |
| 檔案上傳 | ✅ Storage | ✅ Base64 |
| 匯出備份 | ✅ | ✅ |
| 離線使用 | ⚠️ 有限快取 | ✅ 完全離線 |
| 多人協作 | ✅ | ❌ |
| Storage 檔案 | ✅ | ❌ |

---

## ⚠️ 重要注意事項

### 1. 資料獨立性
- **Firebase 模式和本地模式的資料是獨立的**
- 在本地模式修改的資料不會自動同步到 Firebase
- 切換模式前請確認資料已備份

### 2. 檔案上傳差異
- **Firebase 模式**：檔案上傳到 Firebase Storage，產生雲端 URL
- **本地模式**：檔案轉換為 Base64 儲存在本地資料庫

### 3. 測試建議
- 先在 Firebase 模式匯出完整備份
- 匯入到本地資料庫
- 切換到本地模式進行測試
- 測試完成後切回 Firebase 模式繼續使用

### 4. 瀏覽器限制
- 本地資料庫使用 IndexedDB，資料存在瀏覽器中
- 清除瀏覽器資料會刪除本地資料庫
- 不同瀏覽器的資料不共享

---

## 🎯 使用場景建議

### ✅ 適合使用本地模式：
- 開發新功能時測試
- 離線環境工作
- 本機測試不影響雲端資料
- 快速驗證功能邏輯

### ✅ 適合使用 Firebase 模式：
- 正式環境使用
- 多人協作
- 需要即時同步
- 需要備份到雲端

---

## 💾 資料備份策略

### 建議流程：
1. **每週備份**：定期從 Firebase 匯出資料
2. **測試前備份**：測試新功能前先備份
3. **重大變更前備份**：大量修改資料前先備份
4. **保留多個版本**：保存不同時間點的備份檔案

### 備份檔案命名範例：
- `TQM_Firebase_備份_2026-01-13.json`
- `TQM_Firebase_備份_測試前_2026-01-15.json`
- `TQM_Firebase_備份_週備份_2026-01-20.json`

---

## 🔧 故障排除

### 問題：匯入失敗
**解決方案**：
- 檢查 JSON 檔案格式是否正確
- 確認瀏覽器支援 IndexedDB
- 查看瀏覽器 Console 錯誤訊息

### 問題：切換模式後資料不見
**解決方案**：
- 這是正常的，兩種模式資料獨立
- 需要先匯入資料再切換模式

### 問題：本地模式無法上傳大檔案
**解決方案**：
- 本地模式使用 Base64 儲存，檔案大小有限制
- 建議使用 Firebase 模式上傳大檔案

---

## 📞 技術支援

如有問題請聯繫系統管理員，並提供：
1. 當前使用的資料庫模式
2. 錯誤訊息截圖
3. 瀏覽器 Console 日誌

---

**最後更新：2026-01-13**
